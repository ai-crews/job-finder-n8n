# 크롤링 워크플로우 로직

---

## 1. 전체 구조

### 1-1. 메인 워크플로우

**역할**

* 기업 우선순위 그룹(P1~P4)에 따라 크롤링 실행 주기 관리

**노드 구성**

* **Cron**

  * 그룹별 실행 주기 설정

    * P1: Daily
    * P2: 주 3회
    * P3: Weekly
    * P4: Monthly
* **Set**

  * 실행 대상 그룹(P1~P4) 정보 저장
* **Execute Workflow**

  * 공통 크롤러 워크플로우 호출

메인 워크플로우는 “언제 실행할지”와 “어떤 그룹을 실행할지”만 결정하며,
실제 크롤링 대상 선정 및 실행 방식은 공통 크롤러 워크플로우에서 처리한다.

---

### 1-2. 공통 크롤러 워크플로우

**역할**

* 크롤링 대상 기업 선별
* 기업별 크롤링 방식(Type A/B/C) 결정
* 크롤러 API 실행

**노드 구성**

* **When Executed by Another Workflow**

  * 메인 워크플로우로부터 group 값 수신
* **Google Sheets**

  * 기업 메타데이터 전체 로드
* **IF**

  * 전달받은 group 값 기준으로 기업 필터링
* **Loop Over Items**

  * 기업별 순차 처리
* **Switch**

  * 기업의 type(A/B/C) 기준 분기
* **HTTP Request**

  * type별 크롤러 API 호출
  * 현재는 구조 검증을 위해 더미 URL 사용
  * 운영 시 DE팀에서 제공한 크롤러 API 엔드포인트로 교체 예정

---

### 1-3. 기업 메타데이터

기업 메타데이터는 Google Sheets로 관리하며,
n8n이 크롤링 대상을 판단하기 위한 설정 테이블 역할을 한다.

> DE팀에서 기업 정보 변경 시 직접 수정 가능

**컬럼 정의**

| 컬럼명       | 설명                 | 비고                       |
| --------- | ------------------ | ------------------------ |
| `company` | 기업명                | 기업 식별자                   |
| `group`   | 우선순위 그룹 (P1~P4)    | 메인 워크플로우에서 전달된 group과 비교 |
| `type`    | 크롤링 유형 (A / B / C) | 크롤러 API 분기 기준            |
| `enabled` | 크롤링 활성화 여부         | 운영 중 크롤링 on/off 제어       |

---

## 2. 동작 흐름

1. 메인 워크플로우에서 특정 P 그룹이 설정된 주기에 따라 실행됨

   * 예: 일요일 오전 8시, P1 그룹 실행
2. 실행된 group 값이 공통 크롤러 워크플로우로 전달됨
3. 공통 크롤러 워크플로우는 전체 기업 중
   전달받은 group과 일치하고 `enabled = TRUE`인 기업만 선별함
4. 선별된 기업을 Loop Over Items를 통해 1개씩 처리함
5. 각 기업의 type 값에 따라 Switch 노드에서 분기됨
6. 분기된 type에 대응하는 크롤러 API를 HTTP Request로 호출함

   * 결과적으로 해당 기업의 크롤러 실행
